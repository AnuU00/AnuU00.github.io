<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>To-Do List</title>
    <link rel="stylesheet" href="todo-styles.css">
</head>
<body>
    <div class="container">
        <div class="todo-app">
            <div class="addDiv">
                <h2>To-Do List <img src="images/todo_icon.png" alt="icon">
                    <img src="images/dustbin.png" class="bin" title="Clear Completed Tasks" onclick="clearTasks()" alt="remove tasks"></h2>
                <div class="row">
                    <input type="text" id="input-box" placeholder="Add a task">
                    <button onclick="addTask()">Add</button>
                </div>
            
            </div>
            
                <ul id="list-container">
                    <!-- <li class="checked">Task 1</li>
                    <li>Task 2</li>
                    <li>Task 3</li> -->
                </ul>
            
            
        </div>
        

    </div>
<script>
        // Import the functions you need from the SDKs you need
    import { initializeApp } from "firebase/app";
    import { getAnalytics } from "firebase/analytics";
    import { getDatabase, ref, set, onValue } from "firebase/database";

    // Your web app's Firebase configuration
    const firebaseConfig = {
    apiKey: "AIzaSyBrrPYPa_KVcCoQkCcQ51CxUA7RDMQBO9I",
    authDomain: "to-do-list-cef00.firebaseapp.com",
    databaseURL: "https://to-do-list-cef00-default-rtdb.firebaseio.com",
    projectId: "to-do-list-cef00",
    storageBucket: "to-do-list-cef00.appspot.com",
    messagingSenderId: "882467650863",
    appId: "1:882467650863:web:331fea17840da9878df5da",
    measurementId: "G-J9VG15WDD9"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);
    const db = getDatabase(app);

    const inputBox = document.getElementById("input-box");
    const listContainer = document.getElementById("list-container");

    window.addTask = function(){
        let input = inputBox.value;
        let trimedInput = input.trim();

        if(trimedInput !== ''){
            let li = document.createElement("li");
            li.style.overflowWrap = "break-word";
            li.innerHTML = inputBox.value;
            listContainer.appendChild(li);
            let span = document.createElement("span");
            span.innerHTML = "\u00d7";
            li.appendChild(span);
        }
        
        inputBox.value = "";
        saveData()
    }
    document.querySelector('button').addEventListener('click', addTask);

    listContainer.addEventListener("click", function(e){
        e.preventDefault();
        if(e.target.tagName === "LI"){
            e.target.classList.toggle("checked");
            saveData()
        }
        else if(e.target.tagName === "SPAN"){
            e.target.parentElement.remove();
            saveData()
        }
    }, false);

    function clearTasks(){
        let checkedItems = document.querySelectorAll('.checked');

        for(let i=0; i<checkedItems.length; i++){
            checkedItems[i].remove();
        }
        saveData();
    }

    window.addEventListener("scroll", function(){
        let addDiv = document.querySelector("h2");
        addDiv.classList.toggle("sticky", this.window.scrollY > 0);
    })

    function saveData(){
        let tasks = listContainer.innerHTML;
        set(ref(db, '/'), {
            tasks: tasks
        });
    }

    function showData(){
        onValue(ref(db, '/'), (snapshot) => {
            const data = snapshot.val();
            if (data) {
                listContainer.innerHTML = data.tasks;
            }
        });
    }
    showData();

</script>

</body>
</html>